<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Générateur de Devis — ETS NIASS & FRÈRE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f6fbff;--blue1:#0f4ac8;--blue2:#1a67ff;--muted:#666}
    *{box-sizing:border-box;font-family:'Inter',system-ui,Segoe UI,Roboto,Arial}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);color:#102a43}
    .container{max-width:1100px;margin:28px auto;padding:24px}
    header{position:relative;background:white;padding:22px;border-radius:16px;overflow:visible;box-shadow:0 6px 30px rgba(12,40,120,0.08)}
    /* curved blues */
    header::before, header::after{content:"";position:absolute;border-radius:50%;z-index:0}
    header::before{width:420px;height:300px;background:radial-gradient(circle at 20% 20%,var(--blue1),transparent 40%);left:-120px;top:40px;transform:rotate(-20deg);opacity:0.95}
    header::after{width:360px;height:220px;background:radial-gradient(circle at 80% 80%,var(--blue2),transparent 40%);right:-80px;bottom:0;transform:rotate(10deg);opacity:0.95}
    .header-inner{position:relative;z-index:2;display:flex;gap:20px}
    .logo{margin-left:auto}
    .logo img{width:120px;height:120px;object-fit:cover;border-radius:0;display:block}
    .company-info{position:absolute;right:20px;top:20px;text-align:right;max-width:320px}
    .company-info strong{display:block}

    form{margin-top:8px;display:grid;grid-template-columns:1fr 360px;gap:18px;position:relative;z-index:2}
    .left{background:#fff;padding:18px;border-radius:12px}
    .right{background:#fff;padding:18px;border-radius:12px;height:100%}

    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input[type=text],input[type=number],select,textarea{width:100%;padding:10px;border:1px solid #e5eefc;border-radius:8px;font-size:15px}
    .radio-group{display:flex;gap:12px;align-items:center}
    .small{font-size:13px;color:var(--muted)}

    .table-wrap{margin-top:12px;overflow:auto}
    table{width:100%;border-collapse:collapse;background:#fff}
    th,td{padding:10px;border-bottom:1px solid #eef4ff;text-align:left}
    th{background:linear-gradient(90deg,var(--blue1),var(--blue2));color:white;font-weight:600}
    .actions{display:flex;gap:8px}
    .btn{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--blue1),var(--blue2));color:white}
    .btn-ghost{background:transparent;border:1px solid #dbeafe;color:var(--blue1)}

    .bottom{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
    .devis-list{margin-top:18px;background:#fff;padding:12px;border-radius:12px}
    .devis-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #f1f7ff}
    .muted{color:var(--muted)}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    /* responsive */
    @media(max-width:980px){form{grid-template-columns:1fr} .company-info{position:static;text-align:left;margin-top:12px}}
    .devis-date-header {
    position: absolute;
    top: 110px;
    left: 20px;
    z-index: 3;
    color: white;
    font-size: 12px;
    background: rgba(0, 0, 0, 0.2);
    padding: 4px 8px;
    border-radius: 4px;
}
    @media (max-width: 640px) {
    .company-info {
        max-width: 55%;
        font-size: 10px;
    }
    
    .company-name {
        font-size: 14px;
    }
    
    .devis-info {
        top: 150px;
        right: 10px;
        font-size: 10px;
        padding: 8px;
    }
    
    .devis-number {
        font-size: 14px;
    }
    
    .client-info {
        margin-top: 80px;
        margin-left: 10px;
        margin-right: 10px;
        padding: 10px;
    }
    
    .container {
        padding-left: 10px;
        padding-right: 10px;
    }
    
    .logo-container {
        width: 80px;
        height: 80px;
        top: 15px;
        right: 15px;
    }
    
    .devis-date-header {
        top: 100px;
        font-size: 10px;
    }
    
    /* Ajustements pour les tableaux */
    .table-container {
        overflow-x: auto;
        font-size: 12px;
    }
    
    table {
        font-size: 12px;
    }
    
    th, td {
        padding: 4px 8px;
    }
    
    /* Ajustements pour les formulaires */
    input, select {
        font-size: 14px; /* Évite le zoom sur iOS */
    }
}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-inner">
        <div>
          <h1 style="margin:0;font-size:20px">Devis - ETS NIASS & FRÈRE</h1>
         </div>
        <div class="logo" title="Logo">
          <img src="https://i.postimg.cc/wxRckfnt/3.png" alt="logo">
        </div>
      </div>

     

    </header>

    <form id="devisForm">
      <div class="left">
        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
          <div>
            <label>Type</label>
            <div class="radio-group">
              <label><input type="radio" name="typeClient" value="Client" checked> Client</label>
              <label><input type="radio" name="typeClient" value="Entreprise"> Entreprise</label>
            </div>
          </div>
          <div style="min-width:200px">
            <label>Numéro Devis</label>
            <input type="text" id="numDevis" placeholder=" " required>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
          <div>
            <label>Nom (Client / Entreprise)</label>
            <input type="text" id="nomClient" placeholder=" ">
          </div>
          <div>
            <label>Téléphone</label>
            <input type="text" id="telClient" placeholder=" ">
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
          <div>
            <label>Marque du véhicule</label>
            <input type="text" id="marque" placeholder=" ">
          </div>
          <div>
            <label>Matricule</label>
            <input type="text" id="matricule" placeholder=" ">
          </div>
        </div>

        <div style="margin-top:12px">
          <label>Description / informations</label>
          <textarea id="travailInfo" rows="2" placeholder=" "></textarea>
        </div>

        <div class="table-wrap">
          <table id="itemsTable">
            <thead>
              <tr><th>Désignation</th><th>Quantité</th><th>Prix unitaire</th><th>Montant</th><th></th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <button type="button" class="btn btn-ghost" id="addRow">➕ Ajouter une ligne</button>
          <div class="muted" style="margin-left:auto"> </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
          <div style="width:160px">
            <label>TVA (%)</label>
            <input type="number" id="tva" value="18" min="0">
          </div>
          <div style="margin-left:auto;text-align:right">
            <div class="small">Total HT: <span id="totalHT">0</span> FCFA</div>
            <div class="small">Montant TVA: <span id="montantTVA">0</span> FCFA</div>
            <div style="font-weight:700">Total TTC: <span id="totalTTC">0</span> FCFA</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button type="button" class="btn btn-primary" id="generatePdf">Générer</button>
          <button type="button" class="btn" id="saveDevis"> Sauvegarder</button>
          <button type="button" class="btn" id="clearForm">Effacer</button>
        </div>
      </div>

      <div class="right">
        <h3 style="margin-top:0">Liste des devis</h3>
        <div class="devis-list" id="devisList"></div>
       
      </div>
    </form>

    <footer> ETS NIASS & FRÈRE</footer>
  </div>

  <!-- Librairies JS pour PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <script>
    // Utils
    const $ = id => document.getElementById(id);
    const qs = sel => document.querySelector(sel);

    // number to words (français) - simple implementation pour montants entiers
    function numberToWordsFr(n){
      const units = ['zéro','un','deux','trois','quatre','cinq','six','sept','huit','neuf','dix','onze','douze','treize','quatorze','quinze','seize'];
      const tens = ['', '', 'vingt','trente','quarante','cinquante','soixante','soixante','quatre-vingt','quatre-vingt'];
      if(n<0) return 'moins '+numberToWordsFr(-n);
      if(n<=16) return units[n];
      if(n<20) return 'dix-' + units[n-10];
      if(n<100){
        let t = Math.floor(n/10), u = n%10;
        if(t===7 || t===9){
          const base = t===7?60:80; const rem = n - base;
          if(rem<=16) return tens[t] + (rem?'-'+numberToWordsFr(rem):'');
        }
        let sep = u ? (u===1 && (t===1||t>1 && t!==8)?'-et-':'-') : '';
        return tens[t] + (u?sep + numberToWordsFr(u):'');
      }
      if(n<1000){
        let h = Math.floor(n/100), rem = n%100;
        let prefix = h>1? numberToWordsFr(h) + ' cent' : 'cent';
        if(h>1 && rem===0) prefix += 's';
        return prefix + (rem? ' '+numberToWordsFr(rem):'');
      }
      if(n<1000000){
        const k = Math.floor(n/1000), rem = n%1000;
        const prefix = k>1? numberToWordsFr(k)+' mille' : 'mille';
        return prefix + (rem? ' '+numberToWordsFr(rem):'');
      }
      if(n<1000000000){
        const m = Math.floor(n/1000000), rem = n%1000000;
        const prefix = m>1? numberToWordsFr(m)+' million' : 'un million';
        return prefix + (rem? ' '+numberToWordsFr(rem):'');
      }
      return n.toString();
    }

    // Table management
    const tbody = document.querySelector('#itemsTable tbody');
    function addRow(data={designation:'',qty:1,pu:0}){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input class='inp des' value="${escapeHtml(data.designation)}" placeholder='Désignation'></td>
        <td><input class='inp qty' type='number' min='0' value='${data.qty}'></td>
        <td><input class='inp pu' type='number' min='0' value='${data.pu}'></td>
        <td class='montant'>0</td>
        <td><button class='btn btn-ghost btn-sm del'>Suppr</button></td>
      `;
      tbody.appendChild(tr);
      hookRow(tr);
      recalc();
    }

    function escapeHtml(str){ return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    function hookRow(tr){
      const qty = tr.querySelector('.qty');
      const pu = tr.querySelector('.pu');
      const des = tr.querySelector('.des');
      const del = tr.querySelector('.del');
      function update(){
        const q = Number(qty.value)||0; const p = Number(pu.value)||0; tr.querySelector('.montant').textContent = (q*p).toFixed(0);
        recalc();
      }
      qty.addEventListener('input', update);
      pu.addEventListener('input', update);
      des.addEventListener('input', ()=>{});
      del.addEventListener('click', ()=>{ tr.remove(); recalc(); });
    }

    function recalc(){
      const rows = [...tbody.querySelectorAll('tr')];
      let total=0;
      rows.forEach(r=>{ const q=Number(r.querySelector('.qty').value)||0; const p=Number(r.querySelector('.pu').value)||0; total += q*p; });
      const tvaPct = Number($('tva').value)||0; const montantTVA = Math.round(total * tvaPct/100);
      const ttc = Math.round(total + montantTVA);
      $('totalHT').textContent = total.toFixed(0);
      $('montantTVA').textContent = montantTVA.toFixed(0);
      $('totalTTC').textContent = ttc.toFixed(0);
      return {total, montantTVA, ttc};
    }

    // Events
    document.getElementById('addRow').addEventListener('click', ()=>addRow());
    document.getElementById('tva').addEventListener('input', recalc);

    document.getElementById('clearForm').addEventListener('click', ()=>{
      if(confirm('Réinitialiser le formulaire ?')){ document.getElementById('devisForm').reset(); tbody.innerHTML=''; addRow(); recalc(); }
    });

    // PDF generation with jsPDF + autotable
    async function generatePDF(dataObj){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:'pt',format:'a4'});
      const leftMargin = 40; const rightMargin = 40; const pageWidth = doc.internal.pageSize.getWidth();

      // Header: logo at top-right (square)
      const img = new Image(); img.crossOrigin = 'anonymous'; img.src = 'https://i.postimg.cc/wxRckfnt/3.png';
      await new Promise(res=>{ img.onload = res; img.onerror = res; });
      const logoSize = 110; doc.addImage(img, 'JPEG', pageWidth - rightMargin - logoSize, 40, logoSize, logoSize);

      // Company info top-right under logo
      doc.setFontSize(14); doc.setFont('helvetica','bold'); doc.text('ETS NIASS & FRÈRE', pageWidth - rightMargin - 10, 140, {align:'right'});
      doc.setFontSize(10); doc.setFont('helvetica','normal');
      doc.text('VENTE, LOCATION ET RÉPARATION DE VÉHICULES', pageWidth - rightMargin - 10, 154, {align:'right'});
      doc.text('77 47047 42 / 33 825 32 42', pageWidth - rightMargin - 10, 168, {align:'right'});
      doc.text('Rond point Niary Tali, en face Brioche Dorée', pageWidth - rightMargin - 10, 182, {align:'right'});

      // Client info top-left
      doc.setFontSize(16); doc.setFont('helvetica','bold'); doc.text('Devis: '+(dataObj.numDevis||''), leftMargin, 90);
      doc.setFontSize(14); doc.setFont('helvetica','normal');
      doc.text((dataObj.type||'') + ' : ' + (dataObj.nom||''), leftMargin, 110);
      doc.text('Tél: ' + (dataObj.tel||''), leftMargin, 125);
      doc.text('Info Véhicule: ' + (dataObj.marque||'') + '  ' + (dataObj.matricule||''), leftMargin, 140);

      // Work description
      doc.setDrawColor(220); doc.setLineWidth(0.5);
      doc.text('Description:', leftMargin, 170);
      doc.setFontSize(11);
      const split = doc.splitTextToSize(dataObj.travail || '-', pageWidth - leftMargin - rightMargin);
      doc.text(split, leftMargin, 185);

      // Items table
      const startY = 205 + split.length*12;
      const columns = [
        {header:'Désignation',dataKey:'des'},
        {header:'Quantité',dataKey:'qty'},
        {header:'Prix unitaire',dataKey:'pu'},
        {header:'Montant',dataKey:'mont'}
      ];
      doc.autoTable({
        startY, head:[columns.map(c=>c.header)], body: dataObj.items.map(it=>[it.des, it.qty, Number(it.pu).toFixed(0), Number(it.qty*it.pu||0).toFixed(0)]),
        styles:{fontSize:13}, theme:'striped', headStyles:{fillColor:[15,74,200]}, margin:{left:leftMargin,right:rightMargin}
      });

      // Totals under table
      const finalY = doc.lastAutoTable.finalY + 14;
      doc.setFontSize(15);
      doc.text('Total HT : ' + dataObj.totalHT.toFixed(0) + ' FCFA', pageWidth - rightMargin - 10, finalY, {align:'right'});
      doc.text('TVA ('+dataObj.tva+'%) : ' + dataObj.montantTVA.toFixed(0) + ' FCFA', pageWidth - rightMargin - 10, finalY + 14, {align:'right'});
      doc.setFont('helvetica','bold'); doc.text('Total TTC : ' + dataObj.totalTTC.toFixed(0) + ' FCFA', pageWidth - rightMargin - 10, finalY + 32, {align:'right'});

      // Montant en lettre
      const enLettre = numberToWordsFr(Math.round(dataObj.totalTTC));
      doc.setFont('helvetica','normal'); doc.setFontSize(10);
      doc.text('Arrêté le présent devis à la somme de ' + enLettre + ' FRANCS CFA.', leftMargin, finalY + 70);

      // Footer signature line
      doc.setDrawColor(200); doc.line(leftMargin, doc.internal.pageSize.getHeight() - 120, pageWidth - rightMargin, doc.internal.pageSize.getHeight() - 120);
      doc.setFontSize(14); doc.text('Signature client', leftMargin, doc.internal.pageSize.getHeight() - 100);

      // Save / open
      doc.save((dataObj.numDevis||'devis') + '.pdf');
    }

    // Build data and call generate
    document.getElementById('generatePdf').addEventListener('click', async ()=>{
      const data = collectForm();
      await generatePDF(data);
    });

    function collectForm(){
      const type = document.querySelector('input[name="typeClient"]:checked').value;
      const nom = $('nomClient').value;
      const tel = $('telClient').value;
      const marque = $('marque').value;
      const matricule = $('matricule').value;
      const numDevis = $('numDevis').value || 'DV-XXXX';
      const travail = $('travailInfo').value;
      const tva = Number($('tva').value)||0;
      const items = [...tbody.querySelectorAll('tr')].map(r=>({des:r.querySelector('.des').value, qty:Number(r.querySelector('.qty').value)||0, pu:Number(r.querySelector('.pu').value)||0})).filter(i=>i.des||i.qty||i.pu);
      const totals = recalc();
      return {type,nom,tel,marque,matricule,numDevis,travail,tva,items,totalHT:totals.total,montantTVA:totals.montantTVA,totalTTC:totals.ttc};
    }

    // Save devis to localStorage list
    function loadDevisList(){
      const raw = localStorage.getItem('devis_list');
      return raw? JSON.parse(raw):[];
    }
    function saveDevisList(list){ localStorage.setItem('devis_list', JSON.stringify(list)); renderDevisList(); }

    function renderDevisList(){
      const container = $('devisList'); container.innerHTML='';
      const list = loadDevisList();
      if(!list.length){ container.innerHTML='<div class="muted">Aucun devis enregistré — commencez par remplir le formulaire et cliquez sur « Sauvegarder le devis »</div>'; return; }
      list.forEach((d,idx)=>{
        const el = document.createElement('div'); el.className='devis-item';
        el.innerHTML = `<div><strong>${escapeHtml(d.numDevis)}</strong> — ${escapeHtml(d.nom||'—')} <div class='small muted'>${d.totalTTC.toFixed(0)} FCFA</div></div>
          <div class='actions'>
            <button class='btn' data-action='edit' data-idx='${idx}'>✏️</button>
            <button class='btn' data-action='pdf' data-idx='${idx}'>📄</button>
            <button class='btn' data-action='delete' data-idx='${idx}'>🗑️</button>
          </div>`;
        container.appendChild(el);
      });
      container.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
        const act = b.getAttribute('data-action'); const i = Number(b.getAttribute('data-idx'));
        const list = loadDevisList();
        if(act==='delete'){ if(confirm('Supprimer ce devis ?')){ list.splice(i,1); saveDevisList(list); } }
        if(act==='edit'){ populateForm(list[i]); }
        if(act==='pdf'){ generatePDF(list[i]); }
      })); 
    }

    function populateForm(d){
      document.querySelector(`input[name="typeClient"][value="${d.type}"]`).checked = true;
      $('numDevis').value = d.numDevis || '';
      $('nomClient').value = d.nom || '';
      $('telClient').value = d.tel || '';
      $('marque').value = d.marque || '';
      $('matricule').value = d.matricule || '';
      $('travailInfo').value = d.travail || '';
      $('tva').value = d.tva || 0;
      tbody.innerHTML=''; (d.items||[]).forEach(it=>addRow(it)); recalc();
    }

    document.getElementById('saveDevis').addEventListener('click', ()=>{
      const data = collectForm();
      const list = loadDevisList();
      // if same num exists replace
      const exist = list.findIndex(x=>x.numDevis===data.numDevis);
      if(exist>=0){ if(!confirm('Numéro de devis déjà existant — remplacer ?')) return; list[exist]=data; }
      else list.unshift(data);
      saveDevisList(list);
      alert('Devis sauvegardé ✔️');
    });
// Afficher la date actuelle
const now = new Date();
const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
document.getElementById('currentDate').textContent = now.toLocaleDateString('fr-FR', options);
    
    // Charger les devis depuis le localStorage
function loadSavedDevis() {
    const savedDevis = localStorage.getItem('devisHistory');
    if (savedDevis) {
        const devisList = JSON.parse(savedDevis);
        const historyTable = document.getElementById('devisHistory');
        
        // Vider le tableau avant d'ajouter les éléments
        historyTable.innerHTML = '';
        
        // Ajouter chaque devis au tableau
        devisList.forEach(devis => {
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${devis.devisNumber}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${devis.clientName}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${devis.vehicleBrand}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${devis.totalTTC.toFixed(2)} FCFA</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <button class="edit-devis text-blue-600 hover:text-blue-800 mr-2">
                        <i data-feather="edit"></i>
                    </button>
                    <button class="delete-devis text-red-600 hover:text-red-800 mr-2">
                        <i data-feather="trash-2"></i>
                    </button>
                    <button class="regenerate-devis text-green-600 hover:text-green-800">
                        <i data-feather="file-text"></i>
                    </button>
                </td>
            `;
            historyTable.appendChild(newRow);
        });
        
        feather.replace();
    }
}
    
    // Add to history
function addToHistory(devisNumber, clientName, vehicleBrand, totalTTC) {
    // Récupérer les devis existants
    const existingDevis = localStorage.getItem('devisHistory');
    let devisList = existingDevis ? JSON.parse(existingDevis) : [];
    
    // Ajouter le nouveau devis
    devisList.push({
        devisNumber,
        clientName,
        vehicleBrand,
        totalTTC,
        date: new Date().toISOString()
    });
    
    // Sauvegarder dans le localStorage
    localStorage.setItem('devisHistory', JSON.stringify(devisList));
    
    // Mettre à jour l'affichage
    loadSavedDevis();
}
    // Gérer les actions sur les devis (éditer, supprimer, regénérer)
function setupDevisActions() {
    document.addEventListener('click', function(e) {
        if (e.target.closest('.edit-devis')) {
            const row = e.target.closest('tr');
            const devisNumber = row.cells[0].textContent;
            editDevis(devisNumber);
        }
        
        if (e.target.closest('.delete-devis')) {
            const row = e.target.closest('tr');
            const devisNumber = row.cells[0].textContent;
            deleteDevis(devisNumber);
        }
        
        if (e.target.closest('.regenerate-devis')) {
            const row = e.target.closest('tr');
            const devisNumber = row.cells[0].textContent;
            regenerateDevis(devisNumber);
        }
    });
}

// Éditer un devis
function editDevis(devisNumber) {
    const savedDevis = localStorage.getItem('devisHistory');
    if (savedDevis) {
        const devisList = JSON.parse(savedDevis);
        const devis = devisList.find(d => d.devisNumber === devisNumber);
        
        if (devis) {
            // Pré-remplir le formulaire avec les données du devis
            document.getElementById('devisNumber').value = devis.devisNumber;
            document.getElementById('clientName').value = devis.clientName;
            document.getElementById('vehicleBrand').value = devis.vehicleBrand;
            
            // Faire défiler jusqu'au formulaire
            document.querySelector('.client-info').scrollIntoView({ behavior: 'smooth' });
            
            alert(`Devis ${devisNumber} chargé. Complétez les autres champs et générez à nouveau.`);
        }
    }
}

// Supprimer un devis
function deleteDevis(devisNumber) {
    if (confirm(`Êtes-vous sûr de vouloir supprimer le devis ${devisNumber} ?`)) {
        const savedDevis = localStorage.getItem('devisHistory');
        if (savedDevis) {
            let devisList = JSON.parse(savedDevis);
            devisList = devisList.filter(d => d.devisNumber !== devisNumber);
            
            localStorage.setItem('devisHistory', JSON.stringify(devisList));
            loadSavedDevis();
            
            alert(`Devis ${devisNumber} supprimé.`);
        }
    }
}

// Regénérer un devis
function regenerateDevis(devisNumber) {
    const savedDevis = localStorage.getItem('devisHistory');
    if (savedDevis) {
        const devisList = JSON.parse(savedDevis);
        const devis = devisList.find(d => d.devisNumber === devisNumber);
        
        if (devis) {
            // Ici, vous pouvez appeler votre fonction generatePDF avec les données du devis
            alert(`Regénération du devis ${devisNumber} pour ${devis.clientName}`);
            // generatePDF(devis); // À adapter selon votre implémentation
        }
    }
}
    
    // init
    addRow(); renderDevisList();
    
  </script>
</body>
</html>
